function showAddressDeferred(){var n=$("#CustomerID").val(),t=$("#AddressID").val(),i=$("#FormTitleID").val();n===""?window.setTimeout(showAddressDeferred,100):showAddressModal(n,t,i)}function showAddressModal(n,t,i){i===""&&(i="New Address");$("#addressModalLabel").find(".title").html(i);$("#FormTitleID").val("");loadInputForm("AddressDetails","AddressListArea","Addresses",t,n,"AddressForm","AddressFormFields","AddressList","","OpenAddressButton","4","asc","AddressID",!0,"addressModal")}function showNoteDeferred(){var n=$("#CustomerID").val(),t=$("#NoteID").val(),i=$("#FormTitleID").val();n===""?window.setTimeout(showNoteDeferred,100):showNoteModal(n,t,i)}function showNoteModal(n,t,i){i===""&&(i="New Note");$("#noteModalLabel").find(".title").html(i);$("#FormTitleID").val("");loadInputForm("NoteDetails","NoteListArea","Notes",t,n,"NoteForm","NoteFormFields","NoteList","","OpenNoteButton","3","desc","NoteID",!0,"noteModal")}function doQuickSearch(n){$("#FilterQuery").val("C.Surname,LK,"+n+"!~C.Forename,LK,"+n+"!~C.CustomerID,LK,"+n);$("#doSearch").submit()}function showCustomerAlerts(n){var t="/Notes/"+n+"/?handler=Json&alertOnly=true",i=$.get(t,function(n){var i="";for(var r in n)n[r].noteText!==null&&(i+="<p>"+n[r].noteText+"<\/p>");i!==""&&doModal("Customer Alerts",i);console.log(t+" Loaded")});i.fail(function(){doErrorModal("Error Loading "+t,"The list at "+t+" returned a server error and could not be loaded")})}function cusOpenCustomer(n){return`<button type="button" class="btn btn-secondary OpenCustomerButton" data-toggle="modal" data-id="${n.customerID}" data-target="#customerModal" data-loading-text="Record for ${n.forename} ${n.surname}">
                        <i class="fas fa-external-link-alt"></i>
                    </button>`}function cusCustomerPhoto(n){return`<div class="ProfileIconSmall" style="background-color: ${stringToColour(n.forename+n.surname)};">
                        ${getInitials(n.forename,n.surname)}
                    </div>`}function cusCustomerID(n){return`<a tabindex="0" role="button" href="#" target="C.CustomerID" aria-label="CustomerList">
                        ${n.customerID}
                    </a>`}function cusSurname(n){return`<a tabindex="0" role="button" href="#" target="C.Surname" aria-label="CustomerList">
                        ${noNulls(n.surname)}
                    </a>`}function cusForename(n){return`<a tabindex="0" role="button" href="#" target="C.Forename" aria-label="CustomerList">
                        ${noNulls(n.forename)}
                    </a>`}function cusTitle(n){return`<a tabindex="0" role="button" href="#" target="C.Title" aria-label="CustomerList">
                        ${noNulls(n.title)}
                    </a>`}function cusEmail(n){return`<a tabindex="0" role="button" href="#" target="C.Email" aria-label="CustomerList">
                        ${noNulls(n.email)}
                    </a>`}function cusMobilePhone(n){return`<a tabindex="0" role="button" href="#" target="C.MobilePhone" aria-label="CustomerList">
                        ${noNulls(n.mobilePhone)}
                    </a>`}function cusWorkPhone(n){return`<a tabindex="0" role="button" href="#" target="C.WorkPhone" aria-label="CustomerList">
                        ${noNulls(n.workPhone)}
                    </a>`}function cusCanBeContacted(n){var t="";return n.canBeContacted===!0&&(t="checked "),`<a tabindex="0" role="button" href="#" target="C.CanBeContacted" aria-label="CustomerList">
                        <input class="check-box" disabled="disabled" type="checkbox" disabled ${t} />
                    </a>`}function cusAreas(n){return`<a tabindex="0" role="button" href="#" target="CA.Areas" aria-label="CustomerList">
                        ${noNulls(n.areas)}
                    </a>`}function cusOrderValue(n){return`<a tabindex="0" role="button" href="#" target="C.OrderValue" aria-label="CustomerList">
                        ${formatMoney(n.orderValue,0,"Â£")}
                    </a>`}function cusHasOutstandingRemedialWork(n){var t="";return n.hasOutstandingRemedialWork===!0&&(t="checked "),`<a tabindex="0" role="button" href="#" target="C.HasOutstandingRemedialWork" aria-label="CustomerList">
                        <input class="check-box" disabled="disabled" type="checkbox" disabled ${t} />
                    </a>`}function cusShowroomName(n){return`<a tabindex="0" role="button" href="#" target="S.ShowroomName" aria-label="CustomerList">
                        ${noNulls(n.showroomName)}
                    </a>`}function cusDateOfEnquiry(n){return`<a tabindex="0" role="button" href="#" target="C.DateOfEnquiry" aria-label="CustomerList">
                        ${moment(n.dateOfEnquiry).format("DD MMM YY")}
                    </a>`}function adrOpenAddress(n){return`<button type="button" class="btn btn-secondary OpenAddressButton" data-toggle="modal" data-id="${n.addressID}" data-target="#addressModal" data-loading-text="Address at ${n.address1}">
                        <i class="fas fa-external-link-alt"></i>
                    </button>`}function adrAddress(n){return`${BRs(n.address1)}
                    ${BRs(n.address2)}
                    ${BRs(n.address3)}
                    ${BRs(n.address4)}`}function adrPostCode(n){return n.postcodeOut!==null?`${BRs(n.postcodeOut)} ${BRs(n.postcodeIn)}`:``}function adrDateFrom(n){return`${moment(n.dateFrom).format("DD MMM YY")}`}function adrDateTo(n){return n.dateTo!==null?`${moment(n.dateTo).format("DD MMM YY")}`:``}function adrIsPrimary(n){var t="";return n.isPrimary===!0&&(t="checked "),`<input class="check-box" disabled="disabled" type="checkbox" disabled ${t} />`}function notOpenNote(n){return`<button type="button" class="btn btn-secondary OpenNoteButton" data-toggle="modal" data-id="${n.noteID}" data-target="#noteModal" data-loading-text="Note created on ${n.createdDate}">
                        <i class="fas fa-external-link-alt"></i>
                    </button>`}function notIsAlert(n){var t="";return n.isAlert===!0&&(t="checked "),`<input class="check-box" disabled="disabled" type="checkbox" disabled ${t} />`}function notCreatedDate(n){return`${moment(n.createdDate).format("DD MMM YY HH:MM")}`}function audUpdatedDate(n){return`${moment(n.updatedDate).format("DD MMM YY HH:MM")}`}function audUpdatedBy(n){return`${n.applicationUserUpdatedBy.forename} ${n.applicationUserUpdatedBy.surname}`}function hisOpenCustomer(n){return`<button type="button" class="btn btn-secondary OpenCustomerButton" data-dismiss="modal" data-toggle="modal" data-id="${n.objectID}" data-target="#customerModal" data-loading-text="Record for ${n.changeInfo.replace(" Viewed","")}">
                <i class="fas fa-external-link-alt"></i>
            </button>`}function hisUpdatedDate(n){return`${moment(n.updatedDate).format("DD MMM YY HH:MM")}`}$(function(){$("[data-toggle=popover]").popover()});$(".SaveCustomerButton").click(function(){$("#CustomerFormFields").submit();checkApplyOrOkClicked($(this).text())});$("#DeleteCustomerButton").click(function(){$("#CustomerFormFields").submit()});$(".NewCustomerButton").click(function(){$("#CustomerID").val("")});$(".AuditCustomerButton").click(function(){$("#AuditRecordID").val($("#CustomerID").val());$("#AuditTable").val("Customer")});$(".SaveAddressButton").click(function(){$("#AddressFormFields").submit();checkApplyOrOkClicked($(this).text())});$(".DeleteAddressButton").click(function(){$("#AddressFormFields").submit()});$(".NewAddressButton").click(function(){$("#AddressID").val("")});$(".AuditAddressButton").click(function(){$("#AuditRecordID").val($("#AddressID").val());$("#AuditTable").val("Address")});$(".SaveNoteButton").click(function(){$("#NoteFormFields").submit();checkApplyOrOkClicked($(this).text())});$(".DeleteNoteButton").click(function(){$("#NoteFormFields").submit()});$(".NewNoteButton").click(function(){$("#NoteID").val("")});$(".AuditNoteButton").click(function(){$("#AuditRecordID").val($("#NoteID").val());$("#AuditTable").val("Note")});$("#customerModal").on("shown.bs.modal",function(){var n=$("#CustomerID").val(),t=$("#FormTitleID").val();t===""&&(t="New Customer");$("#customerModalLabel").find(".title").html(t);$("#FormTitleID").val("");loadInputForm("CustomerDetails","CustomerListArea","Customers",n,n,"CustomerForm","CustomerFormFields","CustomerList",getSearchParams(),"OpenCustomerButton","3","asc","CustomerID",!0,"customerModal");loadList("AddressListArea","Addresses","Index",n,"AddressList","","OpenAddressButton","4","asc","AddressID");loadList("NoteListArea","Notes","Index",n,"NoteList","","OpenNoteButton","3","desc","NoteID");showCustomerAlerts(n)});$("#customerModal").on("hidden.bs.modal",function(){$("#CustomerTabs a:first").tab("show")});$("#deleteCustomerModal").on("shown.bs.modal",function(){var n=$("#CustomerID").val();loadDeleteForm("DeleteCustomerDetails","CustomerListArea","Customers",n,n,"CustomerForm","CustomerFormFields","CustomerList",getSearchParams(),"OpenCustomerButton","3","asc","CustomerID",!0,"customerModal")});$("#addressModal").on("shown.bs.modal",function(){var n=$("#CustomerID").val(),t=$("#AddressID").val(),i=$("#FormTitleID").val();n===""?(checkApplyOrOkClicked("Apply"),$("#CustomerFormFields").submit(),showAddressDeferred()):showAddressModal(n,t,i)});$("#deleteAddressModal").on("shown.bs.modal",function(){var n=$("#CustomerID").val(),t=$("#AddressID").val();loadDeleteForm("DeleteAddressDetails","AddressListArea","Addresses",t,n,"AddressForm","AddressFormFields","AddressList","","OpenAddressButton","4","asc","AddressID",!0,"addressModal")});$("#noteModal").on("shown.bs.modal",function(){var n=$("#CustomerID").val(),t=$("#NoteID").val(),i=$("#FormTitleID").val();n===""?(checkApplyOrOkClicked("Apply"),$("#CustomerFormFields").submit(),showNoteDeferred()):showNoteModal(n,t,i)});$("#deleteNoteModal").on("shown.bs.modal",function(){var n=$("#CustomerID").val(),t=$("#NoteID").val();loadDeleteForm("DeleteNoteDetails","NoteListArea","Notes",t,n,"NoteForm","NoteFormFields","NoteList","","OpenNoteButton","3","desc","NoteID",!0,"noteModal")});$("#auditModal").on("shown.bs.modal",function(){var n=$("#AuditRecordID").val(),t=$("#AuditTable").val();loadList("AuditListArea","AuditTrails","Index",t+"/"+n,"AuditList","","OpenAuditButton","1","desc","")});$("#customerHistoryModal").on("shown.bs.modal",function(){var n=$("#UserID").val();loadList("CustomerHistoryListArea","AuditTrails","History","History/Customer/"+n,"CustomerHistoryList","","OpenCustomerButton","1","desc","CustomerID")});$(".CustomerQuickSearch").keypress(function(n){if(n.which===13){var t=$(this).val();return doQuickSearch(t),!1}});$(".CustomerQuickSearchButton").click(function(){val=$(".CustomerQuickSearch").val();doQuickSearch(val)});$(function(){$.extend($.fn.dataTable.defaults,{language:{processing:'<div class="col text-center LoadingArea"><i class="fas fa-spinner fa-spin"><\/i><\/div>'}});var n=$("#FilterQuery").val();$("#CustomerList").DataTable({dom:'<"row"<"col-sm-12 col-md-6"l><"col-sm-12 col-md-6"f>>rt<"row"<"col-md text-right"B>><"row"<"col-sm-12 col-md-5"i><"col-sm-12 col-md-7"p>>',buttons:[{extend:"colvis",text:'<i class="fas fa-columns"><\/i> Columns'},{extend:"copyHtml5",text:'<i class="far fa-copy"><\/i> Copy',exportOptions:{columns:":visible"}},{extend:"excelHtml5",text:'<i class="far fa-file-excel"><\/i> Excel',exportOptions:{columns:":visible"}},{extend:"csvHtml5",text:'<i class="fas fa-file-csv"><\/i> CSV',exportOptions:{columns:":visible"}},{extend:"pdfHtml5",text:'<i class="far fa-file-pdf"><\/i> PDF',exportOptions:{columns:":visible"}},{extend:"print",text:'<i class="fas fa-print"><\/i> Print',exportOptions:{columns:":visible"}}],processing:!0,serverSide:!1,colReorder:!0,ajax:{url:"/Customers/?handler=Json&search="+n,dataSrc:""},columns:[{data:{_:"customerID",sort:"customerID",filter:"customerID",display:cusOpenCustomer}},{data:{_:"customerID",sort:"customerID",filter:"customerID",display:cusCustomerPhoto}},{data:{_:"customerID",sort:"customerID",filter:"customerID",display:cusCustomerID}},{data:{_:"surname",sort:"surname",filter:"surname",display:cusSurname}},{data:{_:"forename",sort:"forename",filter:"forename",display:cusForename}},{data:{_:"title",sort:"title",filter:"title",display:cusTitle}},{data:{_:"email",sort:"email",filter:"email",display:cusEmail}},{data:{_:"mobilePhone",sort:"mobilePhone",filter:"mobilePhone",display:cusMobilePhone}},{data:{_:"workPhone",sort:"workPhone",filter:"workPhone",display:cusWorkPhone}},{data:{_:"canBeContacted",sort:"canBeContacted",filter:"canBeContacted",display:cusCanBeContacted}},{data:{_:"areas",sort:"areas",filter:"areas",display:cusAreas}},{data:{_:"orderValue",sort:"orderValue",filter:"orderValue",display:cusOrderValue}},{data:{_:"hasOutstandingRemedialWork",sort:"hasOutstandingRemedialWork",filter:"hasOutstandingRemedialWork",display:cusHasOutstandingRemedialWork}},{data:{_:"showroomName",sort:"showroomName",filter:"showroomName",display:cusShowroomName}},{data:{_:"dateOfEnquiry",sort:"dateOfEnquiry",filter:"dateOfEnquiry",display:cusDateOfEnquiry}}],order:[[3,"asc"],[4,"asc"],[2,"asc"]]});$("#AddressList").DataTable({dom:'<"row"<"col-sm-12 col-md-6"l><"col-sm-12 col-md-6"f>>rt<"row"<"col-md text-right"B>><"row"<"col-sm-12 col-md-5"i><"col-sm-12 col-md-7"p>>',buttons:[{extend:"colvis",text:'<i class="fas fa-columns"><\/i> Columns'},{extend:"copyHtml5",text:'<i class="far fa-copy"><\/i> Copy',exportOptions:{columns:":visible"}},{extend:"excelHtml5",text:'<i class="far fa-file-excel"><\/i> Excel',exportOptions:{columns:":visible"}},{extend:"csvHtml5",text:'<i class="fas fa-file-csv"><\/i> CSV',exportOptions:{columns:":visible"}},{extend:"pdfHtml5",text:'<i class="far fa-file-pdf"><\/i> PDF',exportOptions:{columns:":visible"}},{extend:"print",text:'<i class="fas fa-print"><\/i> Print',exportOptions:{columns:":visible"}}],processing:!0,serverSide:!1,colReorder:!0,ajax:{url:"/Addresses/0/?handler=Json",dataSrc:""},columns:[{data:{_:"addressID",sort:"addressID",filter:"addressID",display:adrOpenAddress}},{data:{_:"address1",sort:"address1",filter:"address1",display:adrAddress}},{data:{_:"postcodeOut",sort:"postcodeOut",filter:"postcodeOut",display:adrPostCode}},{data:"homePhone"},{data:{_:"dateFrom",sort:"dateFrom",filter:"dateFrom",display:adrDateFrom}},{data:{_:"dateTo",sort:"dateTo",filter:"dateTo",display:adrDateTo}},{data:{_:"isPrimary",sort:"isPrimary",filter:"isPrimary",display:adrIsPrimary}},{data:"addressType.addressTypeName"}],order:[[3,"asc"],[4,"asc"],[2,"asc"]]});$("#NoteList").DataTable({dom:'<"row"<"col-sm-12 col-md-6"l><"col-sm-12 col-md-6"f>>rt<"row"<"col-md text-right"B>><"row"<"col-sm-12 col-md-5"i><"col-sm-12 col-md-7"p>>',buttons:[{extend:"colvis",text:'<i class="fas fa-columns"><\/i> Columns'},{extend:"copyHtml5",text:'<i class="far fa-copy"><\/i> Copy',exportOptions:{columns:":visible"}},{extend:"excelHtml5",text:'<i class="far fa-file-excel"><\/i> Excel',exportOptions:{columns:":visible"}},{extend:"csvHtml5",text:'<i class="fas fa-file-csv"><\/i> CSV',exportOptions:{columns:":visible"}},{extend:"pdfHtml5",text:'<i class="far fa-file-pdf"><\/i> PDF',exportOptions:{columns:":visible"}},{extend:"print",text:'<i class="fas fa-print"><\/i> Print',exportOptions:{columns:":visible"}}],processing:!0,serverSide:!1,colReorder:!0,ajax:{url:"/Notes/0/?handler=Json",dataSrc:""},columns:[{data:{_:"noteID",sort:"noteID",filter:"noteID",display:notOpenNote}},{data:"noteText"},{data:{_:"isAlert",sort:"isAlert",filter:"isAlert",display:notIsAlert}},{data:{_:"createdDate",sort:"createdDate",filter:"createdDate",display:notCreatedDate}}],order:[[1,"asc"],[2,"asc"]]});$("#AuditList").DataTable({dom:'<"row"<"col-sm-12 col-md-6"l><"col-sm-12 col-md-6"f>>rt<"row"<"col-md text-right"B>><"row"<"col-sm-12 col-md-5"i><"col-sm-12 col-md-7"p>>',buttons:[{extend:"colvis",text:'<i class="fas fa-columns"><\/i> Columns'},{extend:"copyHtml5",text:'<i class="far fa-copy"><\/i> Copy',exportOptions:{columns:":visible"}},{extend:"excelHtml5",text:'<i class="far fa-file-excel"><\/i> Excel',exportOptions:{columns:":visible"}},{extend:"csvHtml5",text:'<i class="fas fa-file-csv"><\/i> CSV',exportOptions:{columns:":visible"}},{extend:"pdfHtml5",text:'<i class="far fa-file-pdf"><\/i> PDF',exportOptions:{columns:":visible"}},{extend:"print",text:'<i class="fas fa-print"><\/i> Print',exportOptions:{columns:":visible"}}],processing:!0,serverSide:!1,colReorder:!0,ajax:{url:"/AuditTrails/none/?handler=Json",dataSrc:""},columns:[{data:"changeInfo"},{data:{_:"updatedDate",sort:"updatedDate",filter:"updatedDate",display:audUpdatedDate}},{data:{_:"applicationUserUpdatedBy.forename",sort:"applicationUserUpdatedBy.forename",filter:"applicationUserUpdatedBy.forename",display:audUpdatedBy}}],order:[[1,"desc"]]});$("#CustomerHistoryList").DataTable({dom:'<"row"<"col-sm-12 col-md-6"l><"col-sm-12 col-md-6"f>>rt<"row"<"col-md text-right"B>><"row"<"col-sm-12 col-md-5"i><"col-sm-12 col-md-7"p>>',buttons:[{extend:"colvis",text:'<i class="fas fa-columns"><\/i> Columns'},{extend:"copyHtml5",text:'<i class="far fa-copy"><\/i> Copy',exportOptions:{columns:":visible"}},{extend:"excelHtml5",text:'<i class="far fa-file-excel"><\/i> Excel',exportOptions:{columns:":visible"}},{extend:"csvHtml5",text:'<i class="fas fa-file-csv"><\/i> CSV',exportOptions:{columns:":visible"}},{extend:"pdfHtml5",text:'<i class="far fa-file-pdf"><\/i> PDF',exportOptions:{columns:":visible"}},{extend:"print",text:'<i class="fas fa-print"><\/i> Print',exportOptions:{columns:":visible"}}],processing:!0,serverSide:!1,colReorder:!0,ajax:{url:"/AuditTrails/History/Customer/none/?handler=Json",dataSrc:""},columns:[{data:{_:"auditTrailID",sort:"auditTrailID",filter:"auditTrailID",display:hisOpenCustomer}},{data:"changeInfo"},{data:{_:"updatedDate",sort:"updatedDate",filter:"updatedDate",display:hisUpdatedDate}}],order:[[1,"desc"]]})});$("#CustomerList").on("draw.dt",function(){attachListFunctions("OpenCustomerButton","CustomerID")});$("#AddressList").on("draw.dt",function(){attachListFunctions("OpenAddressButton","AddressID")});$("#NoteList").on("draw.dt",function(){attachListFunctions("OpenNoteButton","NoteID")});$("#CustomerHistoryList").on("draw.dt",function(){attachListFunctions("OpenCustomerButton","CustomerID")});